{{- /* Detect OS type */ -}}
{{- $osid := .chezmoi.os -}}
{{- if hasKey .chezmoi.osRelease "id" -}}
{{-   $osid = printf "%s-%s" .chezmoi.os .chezmoi.osRelease.id -}}
{{- end -}}

{{- /* Detect WSL */ -}}
{{- $is_wsl := false -}}
{{- if eq .chezmoi.os "linux" -}}
{{-   if (.chezmoi.kernel.osrelease | lower | contains "microsoft") -}}
{{-     $is_wsl = true -}}
{{-   end -}}
{{- end -}}

{{- /* Detect Windows username for WSL file sync */ -}}
{{- $win_user := "" -}}
{{- if $is_wsl -}}
{{-   $win_user = (output "bash" "-c" "ls /mnt/c/Users/ | grep -v -E '^(All Users|Default|Default User|Public|desktop.ini)$' | head -1" | trim) -}}
{{- end -}}

{{- /* Prompt for git identity */ -}}
{{- $name := promptStringOnce . "name" "Git full name" -}}
{{- $email := promptStringOnce . "email" "Git email address" -}}

[data]
    name = {{ $name | quote }}
    email = {{ $email | quote }}
    osid = {{ $osid | quote }}
    is_wsl = {{ $is_wsl }}
    win_user = {{ $win_user | quote }}
